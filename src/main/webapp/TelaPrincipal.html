<!DOCTYPE html>
<html>
    <head>
	<!--Import Google Icon Font-->
        <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="asset/css/materialize.min.css">
        
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>

	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8"/>
    </head>
    <body class="purple lighten-5">
        <!--Import jQuery before materialize.js-->
        <div class="navbar-fixed">
            <nav>
                <div class="nav-wrapper purple darken-4">
                    <ul class="right">
                        <li><a id="nome"></a></li>
                        <li><a id="email"></a></li>
                        <li><a id="buttonLogout">Sair</a></li>
                    </ul>
                </div>
            </nav>
	</div>
        <div class="row">
            <nav>
                <div class="nav-wrapper">
                    <form>
                        <div class="input-field purple darken-4 col s10">
                            <input id="search" type="search" required>
                            <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                            <i class="material-icons">close</i>
                        </div>
                        <div class="purple lighten-5 col s2">
                            <button class="btn waves-effect waves-light purple darken-4" type="submit" name="action">Procurar</button>
                        </div>
                    </form>
                </div>
            </nav>
        </div>
        <div class="row">
            <div class="col s10">
                <!-- Dropdown Trigger -->
                <a class='dropdown-trigger btn purple darken-4' href='#' data-target='dropdown1'>Selecionar Categoria</a>
                
                <!-- Dropdown Structure -->
                <ul id='dropdown1' class='dropdown-content'>
                    <li><a href="#!" class="purple-text text-darken-4">Programação</a></li>
                    <li><a href="#!" class="purple-text text-darken-4">Front-end</a></li>
                    <li><a href="#!" class="purple-text text-darken-4">Mobile</a></li>
                    <li><a href="#!" class="purple-text text-darken-4">Infraestrutura</a></li>
                    <li><a href="#!" class="purple-text text-darken-4">Design & UX</a></li>
                    <li><a href="#!" class="purple-text text-darken-4">Business</a></li>
                    <li><a href="#!" class="purple-text text-darken-4">Assuntos Gerais</a></li>
                </ul>
            </div>
            <div class="purple lighten-5 col s2">
                <a class="waves-effect waves-light btn modal-trigger purple darken-4" href="#modal1">Novo Topico</a>
            </div>
        </div>
        <div class="row">
            <div class="col s6">
                <div class="container">
                    <ul class="collection">
                        <li class="collection-item col s12">
                            <div class="row">
                                <div class="col s5">
                                    Tópico
                                </div>
                                <div class="col s7">
                                    Categoria
                                </div>
                            </div>
                        </li>
                        <li class="collection-item col s12">
                            <div class="row">
                                <div class="col s5">
                                    Alvin
                                </div>
                                <div class="col s7">
                                    Alvin
                                    <a href="#!" class="secondary-content">
                                        <i class="material-icons">send</i>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="collection-item col s12">
                            <div class="row">
                                <div class="col s5">
                                    Alvin
                                </div>
                                <div class="col s7">
                                    Alvin
                                    <a href="#!" class="secondary-content">
                                        <i class="material-icons">send</i>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="collection-item col s12">
                            <div class="row">
                                <div class="col s5">
                                    Alvin
                                </div>
                                <div class="col s7">
                                    Alvin
                                    <a href="#!" class="secondary-content">
                                        <i class="material-icons">send</i>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="collection-item col s12">
                            <div class="row">
                                <div class="col s5">
                                    Alvin
                                </div>
                                <div class="col s7">
                                    Alvin
                                    <a href="#!" class="secondary-content">
                                        <i class="material-icons">send</i>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="collection-item col s12">
                            <div class="row">
                                <div class="col s5">
                                    Alvin
                                </div>
                                <div class="col s7">
                                    Alvin
                                    <a href="#!" class="secondary-content">
                                        <i class="material-icons">send</i>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="collection-item col s12">
                            <div class="row">
                                <div class="col s5">
                                    Alvin
                                </div>
                                <div class="col s7">
                                    Alvin
                                    <a href="#!" class="secondary-content">
                                        <i class="material-icons">send</i>
                                    </a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col s6">
            </div>
        </div>
        <div id="modal1" class="modal bottom-sheet">
            <div class="modal-content">
                <h4>Modal Header</h4>
                <p>A bunch of text</p>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
            </div>
        </div>
        
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <!-- Compiled and minified JavaScript -->
  	<script src="asset/js/materialize.min.js"></script>
        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyCeMk39RkNE1OuUxtLiS1GNO_Zs6hX_rJ4",
                authDomain: "bandod2-b3aa2.firebaseapp.com",
                databaseURL: "https://bandod2-b3aa2.firebaseio.com",
                projectId: "bandod2-b3aa2",
                storageBucket: "",
                messagingSenderId: "304746556105"
            };
            firebase.initializeApp(config);
	</script>
        <script type="text/javascript" src="asset/js/localStoragePlus.js"></script>
        <script>
            // Or with jQuery
            $(document).ready(function(){
                $('.dropdown-trigger').dropdown();
                $('.modal').modal();
            });
            firebase.auth().onAuthStateChanged(firebaseUser =>{
		if(firebaseUser){
                    console.log("ta on");
                }else{
                    console.log("ta off");
                    localStorage.setObject("usu", []);
                    window.location.replace("Login.html");
                }
            });
            // Pegando o elemento do butao sair.
            const btnLogout = document.getElementById('buttonLogout');
            
            // A funçao para deslogar o usuario do firebase. com o evento de click e a funcao signOut.
            btnLogout.addEventListener('click', e => {
    
                firebase.auth().signOut();
                localStorage.setObject("usu", []);
                //O usuario e mandado para a pagina inicial.
                window.location.replace("Login.html");
            });
            
            let array = localStorage.getObject("usu");
            
            const dbRefObjec = firebase.database().ref();
            
            const two = dbRefObjec.child('users').orderByChild('email').equalTo(array[0].email);

            two.on('child_added', snap => {

                document.getElementById("nome").innerHTML = snap.val().nome;
                document.getElementById("email").innerHTML = array[0].email;

                let user = {
                    name: snap.val().nome,
                    email: snap.val().email
                };

                array = [];
                array.push(user);
                localStorage.setObject("usu", array);
                
            });


        </script>
    </body>
</html>